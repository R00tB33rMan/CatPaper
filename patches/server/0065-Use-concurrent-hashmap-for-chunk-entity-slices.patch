From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: camdenorrb <me@12oclock.dev>
Date: Mon, 14 Nov 2022 21:03:14 -0600
Subject: [PATCH] Use concurrent hashmap for chunk entity slices


diff --git a/src/main/java/io/papermc/paper/world/ChunkEntitySlices.java b/src/main/java/io/papermc/paper/world/ChunkEntitySlices.java
index 56e893f232e11abd30262e5dba22bc6f63c96d4b..0e9561e607b6d4e5cce88ffa7cfc6ed021e18144 100644
--- a/src/main/java/io/papermc/paper/world/ChunkEntitySlices.java
+++ b/src/main/java/io/papermc/paper/world/ChunkEntitySlices.java
@@ -20,6 +20,7 @@ import org.jetbrains.annotations.NotNull;
 import org.jetbrains.annotations.Nullable;
 
 import java.util.*;
+import java.util.concurrent.ConcurrentHashMap;
 import java.util.function.Predicate;
 import java.util.stream.Collectors;
 
@@ -37,7 +38,7 @@ public final class ChunkEntitySlices {
     protected final @NotNull Reference2ObjectOpenHashMap<Class<? extends Entity>, EntityCollectionBySection> entitiesByClass;
 
     // ID -> Entity
-    protected final Map<Integer, Entity> entities = new HashMap<>();
+    protected final Map<Integer, Entity> entities = new ConcurrentHashMap<>();
 
     public ChunkHolder.FullChunkStatus status;
 
