From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: camdenorrb <me@12oclock.dev>
Date: Thu, 20 Oct 2022 02:14:05 -0500
Subject: [PATCH] Proguard actually runs but fails to find libraries


diff --git a/build.gradle.kts b/build.gradle.kts
index 896b9da6e17b7642dce629f48a1057cd7cbeb4d2..8edda2635f7458410c8605f6a3b6a20a5614feab 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -6,6 +6,7 @@ plugins {
     java
     `maven-publish`
     id("com.github.johnrengelman.shadow")
+    id("com.guardsquare.proguard") version "7.3.0-beta2" apply false
 }
 
 dependencies {
@@ -206,6 +207,23 @@ val runtimeClasspathWithoutVanillaServer = configurations.runtimeClasspath.flatM
         runtime.filterNot { it.asFile.absolutePath == vanilla }
     }
 
+val proguardJar = File("thing.jar")
+
+val proguardTask = task("proguard", proguard.gradle.ProGuardTask::class) {
+    //dependsOn("shadowJar")
+    //configuration("proguard.conf")
+    injars(tasks.reobfJar.flatMap { it.outputJar })
+    outjars(proguardJar)
+
+    //configuration("")
+}
+
+tasks.registerRunTask("runProGuard") {
+    description = "Spin up a test server from the proguard archiveFile"
+    classpath(tasks.shadowJar.flatMap { it.archiveFile })
+    classpath(runtimeClasspathWithoutVanillaServer)
+}
+
 tasks.registerRunTask("runShadow") {
     description = "Spin up a test server from the shadowJar archiveFile"
     classpath(tasks.shadowJar.flatMap { it.archiveFile })
diff --git a/proguard.conf b/proguard.conf
new file mode 100644
index 0000000000000000000000000000000000000000..f7447788e34cbbb774c4213b5db8f988d7b86049
--- /dev/null
+++ b/proguard.conf
@@ -0,0 +1,3 @@
+-keep public class * {
+   public * ;
+ }
\ No newline at end of file
